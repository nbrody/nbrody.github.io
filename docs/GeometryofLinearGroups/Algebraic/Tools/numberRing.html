<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Rings - Polynomial Ideal Analysis</title>
    
    <!-- MathQuill CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.css">
    
    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-svg.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.95;
            font-weight: 300;
        }
        
        .main-content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 1.4em;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }
        
        .input-area {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }
        
        .polynomial-input {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        #math-input {
            flex: 1;
            font-size: 1.3em;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            min-height: 50px;
        }
        
        #math-input.mq-editable-field {
            border: 2px solid #dee2e6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        #math-input.mq-editable-field.mq-focused {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .polynomial-list {
            margin-top: 25px;
        }
        
        .polynomial-item {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #dee2e6;
            transition: all 0.3s ease;
        }
        
        .polynomial-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transform: translateX(5px);
        }
        
        .polynomial-math {
            font-size: 1.2em;
            flex: 1;
        }
        
        .btn-remove {
            background: #dc3545;
            color: white;
            padding: 6px 12px;
            font-size: 0.9em;
        }
        
        .btn-remove:hover {
            background: #c82333;
        }
        
        .results-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
            display: none;
        }
        
        .results-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-box {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        /* Collapsible styling for the SageMath Code box */
        .result-box.collapsible details > summary {
            cursor: pointer;
            list-style: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        /* Remove default marker in WebKit */
        .result-box.collapsible summary::-webkit-details-marker { 
            display: none; 
        }
        .result-box.collapsible details > summary::after {
            content: '‚ñ∏'; /* caret */
            font-size: 0.9em;
            margin-left: auto;
            opacity: 0.7;
            transition: transform 0.2s ease;
        }
        .result-box.collapsible details[open] > summary::after {
            content: '‚ñæ';
        }
        
        .result-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .result-content {
            font-size: 1.05em;
            line-height: 1.6;
        }
        
        #sagecell {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }
        
        .sage-output {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .info-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .info-box h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .info-box p {
            opacity: 0.95;
            line-height: 1.6;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #dc3545;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .error-message.active {
            display: block;
        }
        
        .help-text {
            color: #6c757d;
            font-size: 0.9em;
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Number Rings</h1>
            <p class="subtitle">Polynomial Ideal Analysis & Gr√∂bner Basis Computation</p>
        </header>
        
        <div class="main-content">
            <div class="info-box">
                <h3>üìê About This Tool</h3>
                <p>Enter polynomials in $\mathbb{Z}[x_1,...,x_n]$ to analyze the ideal they generate. The tool computes Gr√∂bner bases, checks primality, and calculates Krull dimension. For zero-dimensional ideals over $\mathbb{Q}$, it identifies number fields and their dimensions.</p>
            </div>
            
            <div class="section">
                <h2 class="section-title">Input Polynomials</h2>
                <div class="input-area">
                    <div class="polynomial-input">
                        <span id="math-input"></span>
                        <button class="btn btn-primary" onclick="addPolynomial()">
                            <span>+</span> Add Polynomial
                        </button>
                    </div>
                    <p class="help-text">Enter polynomials using x_1, x_2, etc. Example: x_1^2 + 2*x_2 - 3</p>
                    
                    <div class="polynomial-list" id="polynomial-list"></div>
                    
                    <div style="margin-top: 25px; display: flex; gap: 15px;">
                        <button class="btn btn-primary" onclick="computeResults()" id="compute-btn">
                            <span>‚ö°</span> Generate Number Ring
                        </button>
                        <button class="btn btn-secondary" onclick="loadRandomSample()">
                            <span>üé≤</span> Sample Ideal
                        </button>
                        <button class="btn btn-secondary" onclick="clearAll()">
                            Clear All
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="results-section" id="results-section">
                <h2 class="section-title">Analysis Results</h2>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Computing Gr√∂bner basis and analyzing ideal properties...</p>
                </div>
                
                <div id="results-content">
                    <div class="result-box">
                        <div class="result-title">Polynomial Ring</div>
                        <div class="result-content" id="ring-info"></div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title">Generated Ideal</div>
                        <div class="result-content" id="ideal-info"></div>
                    </div>
                    
                    <div class="result-box collapsible">
                        <details id="sage-code-details">
                          <summary class="result-title">SageMath Code</summary>
                          <div class="result-content">
                             <pre id="sage-code" style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto;"></pre>
                          </div>
                        </details>
                    </div>
                    
                    <div id="sagecell"></div>
                    
                    <div class="error-message" id="error-message"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- jQuery (required for MathQuill) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <!-- MathQuill JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.js"></script>
    
    <!-- SageMathCell -->
    <script src="https://sagecell.sagemath.org/embedded_sagecell.js"></script>
    
    <script>
        // Initialize MathQuill
        const MQ = MathQuill.getInterface(2);
        let mathField;
        let polynomials = [];

        // Library of sample ideals (each entry is an array of LaTeX-like strings)
        const sampleIdealLibrary = [
            { label: '{x_1^2-2}', polys: ['x_1^2-2'] },
            { label: '{x_1^2-x_1-1}', polys: ['x_1^2-x_1-1'] },
            { label: '{3*x_1-1}', polys: ['3*x_1-1'] },
            { label: '{x_1^2-2, x_2^2-3}', polys: ['x_1^2-2', 'x_2^2-3'] },
            { label: '{x_1*x_2-1}', polys: ['x_1*x_2-1'] },
            { label: '{x_1^2-3, 5*x_1-1}', polys: ['x_1^2-3', '5*x_1-1'] }
        ];

        function loadRandomSample() {
            // Pick a random sample
            const pick = sampleIdealLibrary[Math.floor(Math.random() * sampleIdealLibrary.length)];

            // Reset current state
            polynomials = [];
            document.getElementById('results-section').classList.remove('active');
            if (typeof mathField !== 'undefined') {
                mathField.latex('');
            }

            // Add each polynomial from the sample ideal
            pick.polys.forEach((latexStr, idx) => {
                polynomials.push({
                    latex: latexStr,
                    readable: convertLatexToPolynomial(latexStr),
                    id: Date.now() + idx
                });
            });

            // Update the list display
            updatePolynomialList();
        }
        
        $(document).ready(function() {
            // Initialize MathQuill input field
            const mathFieldSpan = document.getElementById('math-input');
            mathField = MQ.MathField(mathFieldSpan, {
                spaceBehavesLikeTab: true,
                handlers: {
                    enter: function() {
                        addPolynomial();
                    }
                }
            });
            
            // Focus on input field
            mathField.focus();
        });
        
        function addPolynomial() {
            const latex = mathField.latex();
            if (!latex.trim()) return;
            
            // Convert LaTeX to readable format
            const polynomial = convertLatexToPolynomial(latex);
            if (!polynomial) {
                showError('Invalid polynomial format. Please use x_1, x_2, etc.');
                return;
            }
            
            polynomials.push({
                latex: latex,
                readable: polynomial,
                id: Date.now()
            });
            
            updatePolynomialList();
            mathField.latex('');
            mathField.focus();
        }
        
        function convertLatexToPolynomial(latex) {
            // Convert LaTeX to a format suitable for SageMath
            let poly = latex;
            
            // Replace x_n with x_n format
            poly = poly.replace(/x_\{(\d+)\}/g, 'x_$1');
            poly = poly.replace(/x_(\d+)/g, 'x_$1');
            
            // Replace LaTeX operations
            poly = poly.replace(/\\cdot/g, '*');
            poly = poly.replace(/\\times/g, '*');
            poly = poly.replace(/\\left/g, '');
            poly = poly.replace(/\\right/g, '');
            poly = poly.replace(/\\/g, '');
            
            // Handle fractions
            poly = poly.replace(/frac\{([^}]+)\}\{([^}]+)\}/g, '($1)/($2)');

            // Replace LaTeX exponentiation with Python/Sage exponentiation
            // Case 1: ^{...} -> **(...)
            poly = poly.replace(/\^\{([^}]+)\}/g, '**($1)');
            // Case 2: ^n -> **n (simple numeric or alphanumeric exponents)
            poly = poly.replace(/\^([A-Za-z0-9_]+)/g, '**$1');
            
            // Clean up spaces
            poly = poly.replace(/\s+/g, ' ').trim();
            
            return poly;
        }
        
        function updatePolynomialList() {
            const listEl = document.getElementById('polynomial-list');
            listEl.innerHTML = '';
            
            polynomials.forEach((poly, index) => {
                const item = document.createElement('div');
                item.className = 'polynomial-item';
                item.innerHTML = `
                    <div class="polynomial-math">
                        $$p_{${index + 1}} = ${poly.latex}$$
                    </div>
                    <button class="btn btn-remove" onclick="removePolynomial(${poly.id})">
                        Remove
                    </button>
                `;
                listEl.appendChild(item);
            });
            
            // Re-render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        }
        
        function removePolynomial(id) {
            polynomials = polynomials.filter(p => p.id !== id);
            updatePolynomialList();
        }
        
        function clearAll() {
            polynomials = [];
            updatePolynomialList();
            document.getElementById('results-section').classList.remove('active');
            mathField.latex('');
            mathField.focus();
        }
        
        function computeResults() {
            if (polynomials.length === 0) {
                showError('Please add at least one polynomial.');
                return;
            }
            
            // Show results section
            const resultsSection = document.getElementById('results-section');
            resultsSection.classList.add('active');
            
            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('results-content').style.display = 'none';
            
            // Generate SageMath code
            const sageCode = generateSageCode();
            
            // Display initial information
            setTimeout(() => {
                document.getElementById('loading').classList.remove('active');
                document.getElementById('results-content').style.display = 'block';
                
                // Determine variables
                const variables = extractVariables();
                const n = variables.length;
                
                // Update ring info
                document.getElementById('ring-info').innerHTML = `
                    <p>Working in the polynomial ring $\\mathbb{Z}[${variables.join(', ')}]$ with ${n} variable${n > 1 ? 's' : ''}.</p>
                `;
                
                // Update ideal info
                const idealLatex = polynomials.map((p, i) => `p_{${i + 1}}`).join(', ');
                document.getElementById('ideal-info').innerHTML = `
                    <p>Ideal $I = \\langle ${idealLatex} \\rangle$ generated by ${polynomials.length} polynomial${polynomials.length > 1 ? 's' : ''}.</p>
                `;
                
                // Display Sage code
                document.getElementById('sage-code').textContent = sageCode;
                
                // Initialize SageMathCell
                sagecell.makeSagecell({
                    inputLocation: '#sagecell',
                    evalButtonText: 'Run Analysis',
                    code: sageCode,
                    hide: ['fullScreen', 'permalink'],
                    autoeval: true
                });
                
                // Re-render MathJax
                if (window.MathJax) {
                    MathJax.typesetPromise();
                }
            }, 1000);
        }
        
        function extractVariables() {
            const varSet = new Set();
            polynomials.forEach(poly => {
                const matches = poly.readable.match(/x_\d+/g) || [];
                matches.forEach(v => varSet.add(v));
            });
            
            const vars = Array.from(varSet).sort((a, b) => {
                const numA = parseInt(a.match(/\d+/)[0]);
                const numB = parseInt(b.match(/\d+/)[0]);
                return numA - numB;
            });
            
            return vars.length > 0 ? vars : ['x_1'];
        }
        
        function generateSageCode() {
            const variables = extractVariables();
            const polyStrings = polynomials.map(p => p.readable);
            
            const code = `# Number Rings Analysis
# Polynomial Ideal Computation and Ring Diagnostics

# Extract variables and create polynomial rings
import re

# Input polynomials as strings
poly_strings = ${JSON.stringify(polyStrings)}

# Extract all variables
all_vars = set()
for poly in poly_strings:
    vars_in_poly = re.findall(r'x_\\d+', poly)
    all_vars.update(vars_in_poly)

# Sort variables by index
var_list = sorted(list(all_vars), key=lambda x: int(x.split('_')[1]))
n = len(var_list)

print("=" * 60)
print(f"POLYNOMIAL RING ANALYSIS")
print("=" * 60)
print(f"Number of variables: {n}")
print(f"Variables: {', '.join(var_list)}")
print()

# Create polynomial rings
var_str = ', '.join(var_list)
R_ZZ = PolynomialRing(ZZ, n, var_str)
R_QQ = PolynomialRing(QQ, n, var_str)

print(f"Integer polynomial ring: {R_ZZ}")
print(f"Rational polynomial ring: {R_QQ}")
print()

# Create variable mapping
var_dict_ZZ = {var_list[i]: R_ZZ.gens()[i] for i in range(n)}
var_dict_QQ = {var_list[i]: R_QQ.gens()[i] for i in range(n)}

# Parse polynomials
def parse_polynomial(poly_str, var_dict):
    # Replace variable names with actual variables
    result = poly_str
    for var_name, var_obj in var_dict.items():
        result = result.replace(var_name, f'var_dict["{var_name}"]')
    return eval(result, {"var_dict": var_dict})

# Generate polynomials in both rings
polys_ZZ = []
polys_QQ = []

print("=" * 60)
print("INPUT POLYNOMIALS")
print("=" * 60)
for i, poly_str in enumerate(poly_strings, 1):
    try:
        p_ZZ = parse_polynomial(poly_str, var_dict_ZZ)
        p_QQ = parse_polynomial(poly_str, var_dict_QQ)
        polys_ZZ.append(p_ZZ)
        polys_QQ.append(p_QQ)
        print(f"p_{i} = {p_ZZ}")
    except Exception as e:
        print(f"Error parsing polynomial {i}: {e}")
        print(f"Original: {poly_str}")

print()

# Create ideals
I_ZZ = R_ZZ.ideal(polys_ZZ)
I_QQ = R_QQ.ideal(polys_QQ)

print("=" * 60)
print("GR√ñBNER BASIS")
print("=" * 60)
print("Computing Gr√∂bner basis over ‚Ñö...")
try:
    gb = I_QQ.groebner_basis()
    print(f"Gr√∂bner basis has {len(gb)} element(s):")
    for i, g in enumerate(gb, 1):
        print(f"  g_{i} = {g}")
except Exception as e:
    print(f"Error computing Gr√∂bner basis: {e}")
    gb = []

print()

# Check if ideal is prime
print("=" * 60)
print("IDEAL PROPERTIES")
print("=" * 60)

try:
    is_prime = I_QQ.is_prime()
    print(f"Is I a prime ideal? {is_prime}")
    if is_prime:
        print("  ‚Üí The quotient ring is an integral domain")
except Exception as e:
    print(f"Could not determine primality: {e}")

print()

# Compute Krull dimension
print("=" * 60)
print("KRULL DIMENSION ANALYSIS")
print("=" * 60)

try:
    dim = I_QQ.dimension()
    print(f"Krull dimension of ‚Ñö[{var_str}]/I_‚Ñö: {dim}")
    
    if dim == 0:
        print()
        print("ZERO-DIMENSIONAL IDEAL DETECTED")
        print("-" * 40)
        print("The quotient ring k_S = ‚Ñö[{var_str}]/I_‚Ñö is a number field!")
        
        # Compute dimension as vector space over Q
        try:
            # Get quotient ring
            Q = R_QQ.quotient(I_QQ)
            
            # Compute vector space dimension
            # This is the number of standard monomials
            gb_ideal = R_QQ.ideal(gb)
            
            # Get leading monomials
            lm = [g.lm() for g in gb]
            
            # Count standard monomials (not divisible by any leading monomial)
            # This gives the dimension of the quotient as a Q-vector space
            
            # For a more direct approach, we can use the fact that for 0-dim ideals,
            # the dimension equals the number of solutions (counting multiplicity)
            # in an algebraic closure
            
            # Alternative: use the Hilbert function
            # For 0-dimensional ideals, this stabilizes to the vector space dimension
            
            print(f"Computing dimension of k_S as a ‚Ñö-vector space...")
            
            # Try to compute using different methods
            if len(gb) > 0:
                # Method 1: Try using normal_basis if available
                try:
                    basis = Q.basis()
                    vdim = len(basis)
                    print(f"Dimension of k_S over ‚Ñö: {vdim}")
                    print(f"Basis elements: {basis[:min(10, len(basis))]}{'...' if len(basis) > 10 else ''}")
                except:
                    # Method 2: Count standard monomials
                    print("Computing via standard monomials...")
                    # This would require more sophisticated computation
                    print("(Exact computation requires analyzing the leading term ideal)")
            
        except Exception as e:
            print(f"Error computing vector space dimension: {e}")
    
    elif dim == -1:
        print("The ideal is the whole ring (dimension = -1)")
        print("This means the ideal contains 1")
    else:
        print(f"The quotient ring has Krull dimension {dim}")
        print(f"This is not a number field (dimension > 0)")
        
except Exception as e:
    print(f"Error computing dimension: {e}")

print()
print("=" * 60)
print("ADDITIONAL PROPERTIES")
print("=" * 60)

# Check if ideal is radical
try:
    is_radical = I_QQ.is_radical()
    print(f"Is I a radical ideal? {is_radical}")
except:
    print("Could not determine if ideal is radical")

# Check if ideal is maximal
try:
    is_maximal = I_QQ.is_maximal()
    print(f"Is I a maximal ideal? {is_maximal}")
    if is_maximal:
        print("  ‚Üí The quotient ring is a field!")
except:
    print("Could not determine if ideal is maximal")

# Check if ideal is principal
try:
    is_principal = I_QQ.is_principal()
    print(f"Is I a principal ideal? {is_principal}")
    if is_principal:
        print(f"  ‚Üí Generator: {I_QQ.gens()[0]}")
except:
    print("Could not determine if ideal is principal")

print()
print("=" * 60)
print("COMPUTATION COMPLETE")
print("=" * 60)`;
            
            return code;
        }
        
        function showError(message) {
            const errorEl = document.getElementById('error-message');
            errorEl.textContent = message;
            errorEl.classList.add('active');
            setTimeout(() => {
                errorEl.classList.remove('active');
            }, 5000);
        }
    </script>
</body>
</html>