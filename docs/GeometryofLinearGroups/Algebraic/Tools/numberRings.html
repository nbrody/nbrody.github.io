<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="../../assets/css/backBtn.css">
  <meta charset="UTF-8">
  <title>Number Ring Tool</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://sagecell.sagemath.org/static/embedded_sagecell.js"></script>
</head>
<body>
  <a href="../../index.html" class="back-button">← Back</a>
  <h1>Number Rings</h1>
  <h2>Gröbner Basis Calculator</h2>
  <p>Enter a finite set of polynomials (e.g., \( x_1^2 + x_2 - 3 \)). Use variables \( x_i \) with integer coefficients.</p>
  <textarea id="poly-input" rows="5" cols="60" placeholder="Enter polynomials, one per line..."></textarea>

  <div id="math-output"></div>
  <div id="sage-cell" style="margin-top: 20px;"></div>
  <div><p>TODO: Output information about the ring. Determine if it remains characteristic zero, and if it is a number ring (embeds in Qbar).</p></div>

  <script>
    // MathJax dynamic rendering of input
    const polyInput = document.getElementById("poly-input");
    const mathOutput = document.getElementById("math-output");
    function renderMath() {
      const lines = polyInput.value.split('\n').filter(line => line.trim() !== "");
      if (lines.length === 0) {
        mathOutput.innerHTML = "";
        return;
      }
      mathOutput.innerHTML = lines.map(line => `\\(${line}\\)`).join("<br>");
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise([mathOutput]);
      }
    }
    polyInput.addEventListener("input", renderMath);
    window.addEventListener("load", renderMath);

    // Set up SageMathCell
    sagecell.makeSagecell({
      inputLocation: '#sage-cell',
      evalButtonText: 'Compute Gröbner basis',
      template: sagecell.templates.minimal,
      autoeval: false,
      linked: true
    });

    // Add dynamic update logic for SageMathCell input
    const updateSageInput = () => {
      const input = polyInput.value;
      const lines = input.split("\n").filter(line => line.trim() !== "");
      const subscripts = input.match(/x_([0-9]+)/g) || [];
      let maxSub = 1;
      if (subscripts.length > 0) {
        maxSub = Math.max(...subscripts.map(s => parseInt(s.split("_")[1])));
      }
      const ringVars = Array.from({length: maxSub}, (_, i) => `x_${i + 1}`).join(",");
      const polyList = lines.map(p => p.replace(/\^/g, "**")).join(",\n  ");
      const code = `R = PolynomialRing(ZZ, [${ringVars}])\nI = R.ideal([${polyList}])\nfor g in I.groebner_basis():\n    print(latex(g))`;
      sagecell.setInputText(document.querySelector("#sage-cell .sagecell_editor"), code);
    };

    document.querySelector("#sage-cell").addEventListener("click", updateSageInput);
  </script>
</body>
</html>