<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="../../../assets/css/backBtn.css">
  <meta charset="UTF-8">
  <title>Number Ring Tool</title>
  <script src="../../../assets/js/common-libs.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.css" />
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: sans-serif;
    }

    h1, h2, p, pre {
      color: #f0f0f0;
    }

    #mathquill-container {
      background-color: #1e1e1e;
      color: white;
      border: 1px solid #444;
    }

    .back-button {
      color: #a0a0ff;
    }

    textarea {
      background-color: #1e1e1e;
      color: white;
      border: 1px solid #444;
    }

    #sage-cell {
      background-color: #1e1e1e;
      color: white;
    }

    .sagecell .CodeMirror {
      background-color: #1e1e1e !important;
      color: white !important;
    }
  </style>
</head>
<body>
  <a href="../../index.html" class="back-button">← Back</a>
  <h1>Number Rings</h1>
  <h2>Gröbner Basis Calculator</h2>
  <p>Enter a finite set of polynomials (e.g., \( x_1^2 + x_2 - 3 \)). Use variables \( x_i \) with integer coefficients.</p>
  <div id="mathquill-container" style="border: 1px solid #ccc; padding: 8px; min-height: 40px; width: 80%;"></div>

  <div id="math-output"></div>
  <div id="sage-cell" style="margin-top: 20px;"></div>
  <div><p>TODO: Output information about the ring. Determine if it remains characteristic zero, and if it is a number ring (embeds in Qbar).</p></div>

  <script>
    const MQ = MathQuill.getInterface(2);
    const mathquillContainer = document.getElementById("mathquill-container");
    const mathField = MQ.MathField(mathquillContainer, {
      spaceBehavesLikeTab: true,
      handlers: {
        edit: () => {
          const latex = mathField.latex();
          renderMath(latex);
        }
      }
    });

    const mathOutput = document.getElementById("math-output");
    function renderMath(latexInput) {
      mathOutput.innerHTML = `\\(${latexInput}\\)`;
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise([mathOutput]);
      }
    }

    function updateSageInput() {
      const input = mathField.latex();
      const textInput = input.replace(/\\cdot/g, "*").replace(/\\,/g, "").replace(/\\left|\\right/g, "");
      const lines = textInput.split(/\\\\|,|;/).map(p => p.trim()).filter(p => p !== "");
      const subscripts = textInput.match(/x_([0-9]+)/g) || [];
      let maxSub = 1;
      if (subscripts.length > 0) {
        maxSub = Math.max(...subscripts.map(s => parseInt(s.split("_")[1])));
      }
      const ringVars = Array.from({length: maxSub}, (_, i) => `x_${i + 1}`).join(",");
      const polyList = lines.map(p => p.replace(/\^/g, "**")).join(",\n  ");
      const code = `R = PolynomialRing(ZZ, [${ringVars}])\nI = R.ideal([${polyList}])\nG = I.groebner_basis()\nfor g in G:\n    print(latex(g))`;
      sagecell.setInputText(document.querySelector("#sage-cell .sagecell_editor"), code);
    }

    document.querySelector("#sage-cell").addEventListener("click", updateSageInput);

    // Set up SageMathCell
    sagecell.makeSagecell({
      inputLocation: '#sage-cell',
      evalButtonText: 'Compute Gröbner basis',
      template: sagecell.templates.minimal,
      autoeval: false,
      linked: true
    });
  </script>
</body>
</html>