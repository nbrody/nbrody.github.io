<!DOCTYPE html>
<html lang="en">

<head>
    <script src="../auth.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>âœ¨ Valentine for Rachie âœ¨</title>
    <style>
        /* âœ¨ Paris-Hilton-coded, early-2000s vibes âœ¨ */
        html,
        body {
            margin: 0;
            height: 100%;
            overflow: hidden;
            background: #ffb6e1;
        }

        body {
            background-image:
                radial-gradient(circle at 10% 15%, rgba(255, 255, 255, 0.8) 0 2px, transparent 3px),
                radial-gradient(circle at 80% 30%, rgba(255, 255, 255, 0.75) 0 2px, transparent 3px),
                radial-gradient(circle at 25% 70%, rgba(255, 255, 255, 0.7) 0 2px, transparent 3px),
                linear-gradient(135deg, #ffc9ec 0%, #ffdff4 35%, #ffe7f7 50%, #ffc0e8 65%, #ff9ad6 100%);
            background-size: auto, auto, auto, 100% 100%;
            color: #ff1493;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewport="0 0 32 32"><text y="24" font-size="24">ðŸ’–</text></svg>') 0 24, auto;
            font-family: "Comic Sans MS", "Comic Sans", "Papyrus", cursive, system-ui, -apple-system;
            image-rendering: pixelated;
        }

        .stage {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            text-align: center;
            padding: 24px;
            pointer-events: none;
            /* Let clicks pass to orbs */
            z-index: 10;
        }

        .card {
            background: rgba(255, 255, 255, 0.4);
            border: 6px double #ff69b4;
            box-shadow: 0 0 0 6px rgba(255, 182, 193, 0.5), 0 0 24px rgba(255, 20, 147, 0.6);
            border-radius: 20px;
            padding: 28px 32px;
            max-width: 600px;
            backdrop-filter: blur(8px);
            pointer-events: auto;
        }

        .glitter {
            font-size: clamp(32px, 6vw, 80px);
            line-height: 1.05;
            margin: 0 0 12px 0;
            background-image: linear-gradient(90deg, #ff1493 0%, #ffffff 20%, #ff69b4 40%, #ff1493 60%, #ffffff 80%, #ff69b4 100%);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: shimmer 2.2s linear infinite;
            text-shadow: 0 0 8px rgba(255, 105, 180, 0.85);
        }

        @keyframes shimmer {
            to {
                background-position: 200% center;
            }
        }

        .tagline {
            font-weight: bold;
            font-size: clamp(14px, 2.5vw, 20px);
            color: #c71585;
            text-shadow: 0 0 6px rgba(255, 192, 203, 0.85);
        }

        marquee {
            color: #ffffff;
            background: repeating-linear-gradient(45deg, #ff69b4, #ff69b4 12px, #ff8ad1 12px, #ff8ad1 24px);
            border-top: 4px dotted #fff;
            border-bottom: 4px dotted #fff;
            padding: 6px 0;
            box-shadow: inset 0 0 12px rgba(255, 255, 255, 0.75);
            font-weight: bold;
            letter-spacing: 2px;
            text-transform: uppercase;
            z-index: 20;
            position: relative;
        }

        /* ORB STYLES */
        .orb-container {
            position: fixed;
            inset: 0;
            z-index: 5;
        }

        .orb {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(4px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            will-change: transform, left, top;
            overflow: hidden;
        }

        .orb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 40px rgba(255, 105, 180, 0.8);
            border-color: #fff;
        }

        .orb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.7;
            mix-blend-mode: overlay;
        }

        /* ZOOM OVERLAY */
        #zoom-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 105, 180, 0.95);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(20px);
            cursor: zoom-out;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease, clip-path 0.7s cubic-bezier(0.19, 1, 0.22, 1);
            /* Start clipped at orb position */
            clip-path: circle(var(--orb-size, 60px) at var(--orb-x, 50%) var(--orb-y, 50%));
        }

        #zoom-overlay.active {
            opacity: 1;
            pointer-events: auto;
            clip-path: circle(150% at var(--orb-x, 50%) var(--orb-y, 50%));
        }

        #zoom-img {
            max-width: 90%;
            max-height: 80%;
            border: 10px solid #fff;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.5), 0 20px 40px rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            transform: scale(0.9);
            transition: transform 0.7s cubic-bezier(0.19, 1, 0.22, 1);
        }

        #zoom-overlay.active #zoom-img {
            transform: scale(1);
        }

        .zoom-caption {
            margin-top: 20px;
            font-size: 32px;
            color: #fff;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            font-family: inherit;
        }

        .sparkle {
            position: fixed;
            pointer-events: none;
            z-index: 200;
            font-size: 18px;
            animation: floatOut 0.9s ease-out forwards;
        }

        @keyframes floatOut {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }

            100% {
                transform: translateY(-40px) scale(0.6);
                opacity: 0;
            }
        }

        .counter {
            background: #fff;
            border: 3px ridge #ff69b4;
            padding: 2px 8px;
            font-weight: bold;
            color: #ff1493;
        }

        blink {
            animation: blinky 1s steps(2, start) infinite;
        }

        @keyframes blinky {
            to {
                visibility: hidden;
            }
        }
    </style>
</head>

<body>
    <marquee scrollamount="10" behavior="alternate">âœ¨ ðŸ’– âœ¨ HAPPY VALENTINE'S DAY RACHIE âœ¨ ðŸ’– âœ¨</marquee>

    <div class="orb-container" id="orb-container"></div>

    <div class="stage">
        <div class="card">
            <h1 class="glitter" id="glitter-text" style="cursor: pointer; user-select: none;">I love you, Rachie</h1>
            <div class="tagline">
                <blink>CLiCK THE ORBS FOR SURPRiSES!</blink>
            </div>
            <div style="margin-top: 15px; font-size: 14px; color: #b0006b;">
                Visitor No. <span class="counter" id="counter">000000</span>
            </div>
        </div>
    </div>

    <div id="zoom-overlay">
        <img id="zoom-img" src="" alt="Zoomed Photo" />
        <div class="zoom-caption">âœ¨ You're Gorgeous! âœ¨</div>
    </div>

    <marquee scrollamount="8" style="position: fixed; bottom: 0; width: 100%;">ðŸ’– ðŸ’‹ ðŸ’– ðŸ’‹ ðŸ’– ðŸ’‹ ðŸ’– ðŸ’‹ ðŸ’– ðŸ’‹ ðŸ’– ðŸ’‹ ðŸ’– ðŸ’‹
        ðŸ’– ðŸ’‹ ðŸ’–</marquee>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';

        // Configuration
        const ORB_COUNT = 7;
        const PHOTO_FILES = [
            'photos/photo1.jpg',
            'photos/photo2.jpg',
            'photos/photo3.jpg',
            'photos/photo4.jpg',
            'photos/photo5.jpg',
            'photos/photo6.jpg',
            'photos/photo7.jpg'
        ];

        let scene, camera, renderer, raycaster, mouse;
        let orbs = [];
        let roses = [];
        const zoomOverlay = document.getElementById('zoom-overlay');
        const zoomImg = document.getElementById('zoom-img');

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 10;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('orb-container').appendChild(renderer.domElement);

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Lights for that glossy ornament look
            const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xff69b4, 15, 50);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);

            const pointLight2 = new THREE.PointLight(0xff1493, 10, 50);
            pointLight2.position.set(-5, -5, 5);
            scene.add(pointLight2);

            const loader = new THREE.TextureLoader();

            for (let i = 0; i < ORB_COUNT; i++) {
                const texture = loader.load(PHOTO_FILES[i % PHOTO_FILES.length]);
                texture.wrapS = THREE.RepeatWrapping;
                texture.wrapT = THREE.RepeatWrapping;
                // 3x2 tiling provides 6 copies and handles sphere UV distortion better
                texture.repeat.set(3, 2);

                const geometry = new THREE.SphereGeometry(1, 32, 32);
                const material = new THREE.MeshPhongMaterial({
                    map: texture,
                    shininess: 100,
                    specular: 0xffffff,
                    emissive: 0xff69b4,
                    emissiveIntensity: 0.1,
                    // Slightly transparent glass-like overlay effect
                });

                const mesh = new THREE.Mesh(geometry, material);

                // Random scale
                const s = 0.8 + Math.random() * 0.7;
                mesh.scale.set(s, s, s);

                // Initial random positions based on camera frustration
                const rangeX = 8 * (window.innerWidth / window.innerHeight);
                const rangeY = 8;
                mesh.position.set(
                    (Math.random() - 0.5) * rangeX,
                    (Math.random() - 0.5) * rangeY,
                    (Math.random() - 0.5) * 4
                );

                mesh.userData = {
                    velocity: new THREE.Vector3(
                        (Math.random() - 0.5) * 0.05,
                        (Math.random() - 0.5) * 0.05,
                        (Math.random() - 0.5) * 0.02
                    ),
                    photoUrl: PHOTO_FILES[i % PHOTO_FILES.length]
                };

                scene.add(mesh);
                orbs.push(mesh);
            }

            // --- Floating Roses ---
            const roseCanvas = document.createElement('canvas');
            roseCanvas.width = 128;
            roseCanvas.height = 128;
            const ctx = roseCanvas.getContext('2d');
            ctx.font = '80px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ðŸŒ¹', 64, 64);
            const roseTexture = new THREE.CanvasTexture(roseCanvas);

            for (let i = 0; i < 25; i++) {
                const roseMaterial = new THREE.SpriteMaterial({ map: roseTexture, transparent: true });
                const sprite = new THREE.Sprite(roseMaterial);

                const s = 0.5 + Math.random() * 0.8;
                sprite.scale.set(s, s, 1);

                sprite.position.set(
                    (Math.random() - 0.5) * 20,
                    (Math.random() - 0.5) * 20,
                    (Math.random() - 0.5) * 10
                );

                sprite.userData = {
                    velocity: new THREE.Vector3(
                        (Math.random() - 0.5) * 0.03,
                        (Math.random() - 0.5) * 0.03,
                        (Math.random() - 0.5) * 0.03
                    ),
                    rotSpeed: (Math.random() - 0.5) * 0.02
                };

                scene.add(sprite);
                roses.push(sprite);
            }

            window.addEventListener('resize', onWindowResize);
            window.addEventListener('click', onDocumentMouseDown);
            animate();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onDocumentMouseDown(event) {
            // Only trigger if not already zooming
            if (zoomOverlay.classList.contains('active')) return;

            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(orbs);

            if (intersects.length > 0) {
                const clickedOrb = intersects[0].object;

                // Calculate screen position for the CSS clip-path animation
                const vector = clickedOrb.position.clone().project(camera);
                const x = (vector.x + 1) / 2 * window.innerWidth;
                const y = -(vector.y - 1) / 2 * window.innerHeight;

                // Approximate radius in pixels
                const scale = clickedOrb.scale.x;
                const p1 = new THREE.Vector3(0, 0, 0).project(camera);
                const p2 = new THREE.Vector3(1 * scale, 0, 0).project(camera);
                const radiusPx = Math.abs((p2.x - p1.x) / 2 * window.innerWidth);

                zoomOverlay.style.setProperty('--orb-x', `${x}px`);
                zoomOverlay.style.setProperty('--orb-y', `${y}px`);
                zoomOverlay.style.setProperty('--orb-size', `${radiusPx}px`);

                zoomImg.src = clickedOrb.userData.photoUrl;
                zoomOverlay.classList.add('active');
            }
        }

        function animate() {
            requestAnimationFrame(animate);

            const aspect = window.innerWidth / window.innerHeight;
            const boundX = 7 * aspect;
            const boundY = 7;

            orbs.forEach(orb => {
                orb.position.add(orb.userData.velocity);

                // Spin them like ornaments
                orb.rotation.y += 0.01;
                orb.rotation.x += 0.005;

                // Bounce
                if (Math.abs(orb.position.x) > boundX) orb.userData.velocity.x *= -1;
                if (Math.abs(orb.position.y) > boundY) orb.userData.velocity.y *= -1;
                if (Math.abs(orb.position.z) > 4) orb.userData.velocity.z *= -1;
            });

            roses.forEach(rose => {
                rose.position.add(rose.userData.velocity);
                rose.material.rotation += rose.userData.rotSpeed;

                // Gentle wrap/bounce for roses
                if (Math.abs(rose.position.x) > 15) rose.userData.velocity.x *= -1;
                if (Math.abs(rose.position.y) > 15) rose.userData.velocity.y *= -1;
                if (Math.abs(rose.position.z) > 10) rose.userData.velocity.z *= -1;
            });

            renderer.render(scene, camera);
        }

        init();

        // Hit counter
        (function () {
            var d = new Date();
            var seed = (d.getFullYear() * 372) + (d.getMonth() * 31) + d.getDate();
            function mulberry32(a) { return function () { var t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296; } }
            var rng = mulberry32(seed);
            var n = Math.floor(100000 + rng() * 899999);
            var el = document.getElementById('counter');
            if (el) el.textContent = String(n);
        })();

        // Sparkle trail
        (function () {
            var icons = ['âœ¨', 'ðŸ’–', 'â­', 'ðŸ’‹'];
            document.addEventListener('mousemove', function (ev) {
                var s = document.createElement('span');
                s.className = 'sparkle';
                s.textContent = icons[(Math.random() * icons.length) | 0];
                s.style.left = (ev.clientX + (Math.random() * 10 - 5)) + 'px';
                s.style.top = (ev.clientY + (Math.random() * 10 - 5)) + 'px';
                document.body.appendChild(s);
                setTimeout(function () { s.remove(); }, 900);
            }, { passive: true });
        })();

        // Toggle Glitter Text
        const glitterText = document.getElementById('glitter-text');
        glitterText.addEventListener('click', () => {
            if (glitterText.textContent === 'I love you, Rachie') {
                glitterText.textContent = 'Ily R';
            } else {
                glitterText.textContent = 'I love you, Rachie';
            }
            glitterText.style.transform = 'scale(1.1)';
            setTimeout(() => glitterText.style.transform = 'scale(1)', 100);
        });

        zoomOverlay.addEventListener('click', () => {
            zoomOverlay.classList.remove('active');
        });
    </script>
</body>

</html>