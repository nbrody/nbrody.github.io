document.addEventListener('DOMContentLoaded', () => {
    // 0: Empty, 1: Wall, 2: Start, 3: Target, 4: Triangle \, 5: Triangle /, 6: Ramp, 7: Wormhole
    const levels = [
        [[1, 1, 1, 1, 1], [1, 2, 0, 3, 1], [1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 0, 0, 1], [1, 0, 1, 0, 1, 0, 1], [1, 0, 0, 0, 3, 0, 1], [1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 0, 1], [1, 0, 1, 1, 0, 1], [1, 0, 0, 3, 0, 1], [1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 1, 1], [1, 1, 0, 0, 0, 1], [1, 1, 1, 0, 3, 1], [1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 0, 0, 1], [1, 1, 1, 0, 0, 0, 1], [1, 0, 0, 0, 0, 3, 1], [1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1], [1, 0, 2, 0, 1, 0, 1], [1, 0, 1, 0, 0, 0, 1], [1, 1, 3, 0, 1, 0, 1], [1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1], [1, 3, 0, 0, 1, 0, 1], [1, 0, 1, 0, 0, 0, 1], [1, 0, 2, 0, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 0, 0, 0, 1], [1, 0, 1, 1, 1, 1, 0, 1], [1, 0, 0, 0, 0, 1, 3, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1], [1, 3, 0, 0, 0, 0, 1, 1], [1, 1, 1, 1, 1, 0, 0, 1], [1, 0, 0, 0, 0, 0, 2, 1], [1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 0, 0, 0, 0, 1], [1, 1, 1, 1, 1, 1, 1, 0, 1], [1, 3, 0, 0, 0, 0, 0, 0, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 4, 1], [1, 0, 1, 0, 1, 1], [1, 3, 0, 0, 1, 1], [1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 5, 1], [1, 1, 1, 0, 0, 1], [1, 1, 1, 1, 3, 1], [1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 0, 4, 1], [1, 0, 1, 1, 0, 0, 1], [1, 3, 0, 0, 0, 1, 1], [1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 0, 4, 0, 1], [1, 0, 1, 1, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 3, 1], [1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 5, 0, 0, 1], [1, 0, 0, 0, 0, 0, 0, 1], [1, 1, 1, 1, 1, 3, 0, 1], [1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 0, 4, 0, 1], [1, 0, 0, 0, 1, 1, 0, 1], [1, 3, 0, 0, 0, 0, 0, 1], [1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 4, 0, 0, 5, 1], [1, 0, 0, 0, 0, 0, 0, 1], [1, 3, 0, 0, 0, 0, 0, 1], [1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 4, 0, 5, 0, 0, 1], [1, 0, 0, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 0, 3, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 4, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 1, 5, 0, 1], [1, 0, 0, 0, 0, 0, 0, 3, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 4, 0, 0, 0, 5, 0, 1], [1, 0, 0, 1, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 4, 0, 0, 3, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1], [1, 2, 0, 6, 0, 1], [1, 1, 1, 1, 3, 1], [1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 6, 1, 0, 0, 1, 1], [1, 1, 1, 1, 0, 0, 3, 1], [1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 0, 5, 1], [1, 1, 1, 0, 1, 0, 1], [1, 0, 0, 4, 3, 0, 1], [1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 6, 1, 6, 3, 1], [1, 1, 1, 1, 1, 1, 1, 1]],
        [[1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 6, 1, 4, 0, 0, 1], [1, 0, 0, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 0, 3, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1]],
        // Level 26: Wormhole Intro
        [[1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 7, 1, 0, 1], [1, 0, 0, 1, 1, 3, 1], [1, 0, 0, 1, 1, 0, 1], [1, 0, 0, 7, 0, 0, 1], [1, 1, 1, 1, 1, 1, 1]],
        // Level 27: Wormhole Bypass
        [[1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 7, 1, 1, 1, 1], [1, 1, 1, 1, 0, 1, 1, 1, 1], [1, 1, 1, 1, 0, 7, 0, 3, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1]],
        // Level 28: Wormhole + Triangle
        [[1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 7, 0, 0, 1], [1, 0, 4, 1, 1, 0, 1], [1, 0, 0, 1, 1, 7, 1], [1, 0, 0, 0, 0, 3, 1], [1, 1, 1, 1, 1, 1, 1]],
        // Level 29: Wormhole + Ramp
        [[1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 6, 7, 0, 0, 0, 1], [1, 1, 1, 1, 1, 1, 0, 1], [1, 3, 0, 0, 0, 0, 7, 1], [1, 1, 1, 1, 1, 1, 1, 1]],
        // Level 30: The Loop
        [[1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 7, 0, 0, 0, 0, 1], [1, 0, 0, 1, 1, 1, 1, 0, 1], [1, 3, 0, 1, 1, 1, 1, 0, 1], [1, 0, 0, 7, 0, 0, 0, 0, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1]]
    ];

    const clue = {
        levels: levels,
        hint: "Slide to the target! Use Triangles to reflect, Ramps to jump, and Wormholes to teleport."
    };

    // Populate level select
    const select = document.getElementById('level-select');
    levels.forEach((_, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `Level ${i + 1}`;
        select.appendChild(opt);
    });

    select.addEventListener('change', (e) => {
        const levelIdx = parseInt(e.target.value);
        window.loadOrboxLevel(levelIdx);
    });

    initOrbox(clue, () => {
        document.getElementById('game-section').classList.add('hidden');
        document.getElementById('victory-screen').classList.remove('hidden');
    });

    // Update level title when loading level
    const originalLoadLevel = window.loadOrboxLevel;
    window.loadOrboxLevel = (idx) => {
        const titleEl = document.getElementById('level-title');
        if (titleEl) titleEl.textContent = `Level ${idx + 1}`;

        const sel = document.getElementById('level-select');
        if (sel) sel.value = idx;

        originalLoadLevel(idx);
    };
});
